$(function(){String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},$("#tableClientInvoicesList").DataTable({aoColumnDefs:[{bSortable:!1,aTargets:[5,6,7]},],language:{decimal:"",emptyTable:"No hay informaci\xf3n disponible",info:"Mostrando del _START_ al _END_ de _TOTAL_ registros",infoEmpty:"Mostrando del 0 al 0 de 0 registros",infoFiltered:"(filtrado de _MAX_ registros totales)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"\xdaltimo",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordernar la columna ascendentemente",sortDescending:": activar para ordernar la columna descendentemente"}}}),$("#tableClientToInvoicesList").DataTable({aoColumnDefs:[{bSortable:!1,aTargets:[0,1,2]},],pageLength:10,order:[[0,"desc"]],language:{decimal:"",emptyTable:"No hay informaci\xf3n disponible",info:"Mostrando del _START_ al _END_ de _TOTAL_ registros",infoEmpty:"Mostrando del 0 al 0 de 0 registros",infoFiltered:"(filtrado de _MAX_ registros totales)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"\xdaltimo",next:"Siguiente",previous:"Anterior"},aria:{sortAscending:": activar para ordernar la columna ascendentemente",sortDescending:": activar para ordernar la columna descendentemente"}}}),$("#fiscal-rfc").bind("keypress",function(a){var b=a.keyCode||a.which;if(!(8==b||b>=35&&b<=40)){var c=new RegExp("^[a-zA-Z0-9_&]*$"),d=String.fromCharCode(a.charCode?a.charCode:a.which);return c.test(d)?void 0:(a.preventDefault(),!1)}}),$("#input-numerocuenta").bind("keypress",function(b){var a=b.which?b.which:b.keyCode;return!(8!=a&&46!=a&&a>31&&(a<48||a>57))&&!($(this).val().length>=4)}),$(".input-upper").on("input",function(c){var a=$(this),b=a[0].selectionStart;$(this).val(function(b,a){return a.toUpperCase()}),a[0].selectionStart=a[0].selectionEnd=b}),$("#modalForm").unbind().on("show.bs.modal",function(c){var a=$(c.relatedTarget),b=a.data("uid"),d=a.data("items");$(this).find(".modal-title").text("Facturar pedido #"+b),$("#orderNum").val(b),$("#orderItems").val(d)}),$("#fiscal-cp").change(function(){$("#cp-loading").fadeIn();var a=$(this).val(),b=$("#systemURL").val();$.ajax({data:{function:"getLocation",cp:a},url:b+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(c){var a,b,d;$("#cp-loading").fadeOut(),c&&(a=c,b=$("#modalForm"),d=a.colonias.split(","),b.find("#fiscal-colonia").val(d[0]),b.find("#fiscal-municipio").val(a.ciudad),b.find("#fiscal-estado").val(a.estado))}})}),$("#fiscal-rfc").change(function(){$("#rfc-loading").fadeIn();var a=$(this).val(),b=$("#systemURL").val();$.ajax({data:{function:"getClient",rfc:a},url:b+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(d){var a,b,c;($("#rfc-loading").fadeOut(),console.log(d),"success"==d.status)?(a=d.Data,(b=$("#modalForm")).find("#clientUID").val(a.UID),b.find("#general-nombre").val(a.Contacto.Nombre),b.find("#general-apellidos").val(a.Contacto.Apellidos),b.find("#general-email").val(a.Contacto.Email),b.find("#fiscal-telefono").val(a.Contacto.Telefono),b.find("#fiscal-nombre").val(a.RazonSocial),b.find("#fiscal-calle").val(a.Calle),b.find("#fiscal-exterior").val(a.Numero),b.find("#fiscal-interior").val(a.Interior),b.find("#fiscal-colonia").val(a.Colonia),b.find("#fiscal-municipio").val(a.Ciudad),b.find("#fiscal-estado").val(a.Estado),b.find("#fiscal-cp").val(a.CodigoPostal),b.find("#fiscal-regimen option").filter(function(){return $(this).text()==a.Regimen}).prop("selected",!0),$(".f-edit").attr("disabled",!1)):($(".f-edit").attr("disabled",!0),(c=$("#modalForm")).find("#clientUID").val(""),c.find("#general-nombre").val(""),c.find("#general-apellidos").val(""),c.find("#general-email").val(""),c.find("#fiscal-telefono").val(""),c.find("#fiscal-nombre").val(""),c.find("#fiscal-calle").val(""),c.find("#fiscal-exterior").val(""),c.find("#fiscal-interior").val(""),c.find("#fiscal-colonia").val(""),c.find("#fiscal-municipio").val(""),c.find("#fiscal-estado").val(""),c.find("#fiscal-cp").val(""))}})}),$("#step-two-button-back-two").unbind().on("click",function(a){$("#step-two").hide(),$("#step-one").fadeIn("slow")}),$("#invoice-button-next").unbind().on("click",function(a){a.preventDefault(),$("#step-one").hide().delay(3e3),$("#step-two").fadeIn("slow")}),$("#paymentMethod").change(function(){var a=$("#paymentMethod option:selected").val();2==a||3==a||4==a||28==a||29==a?$("#num-cta-box").fadeIn("fast"):$("#num-cta-box").fadeOut("fast")}),$("#invoice-button-create").unbind().on("click",function(a){if(a.preventDefault(),!$("#fiscalDataForm").isValid())return console.log("Formulario no se puede enviar"),!1;var m=$(this);$(this).attr("disabled",!0),$(this).val("Procesando");var b=$("#fiscalDataForm").serializeArray(),c={};$.map(b,function(a,b){c[a.name]=a.value});var d=$("#systemURL").val(),e=$("#serieInvoices").val(),f=$("#clientW").val(),g=$("#orderNum").val(),h=$("#paymentMethod option:selected").val(),i=$("#UsoCFDI").val(),j=$("#orderItems").val(),k=$("#input-numerocuenta").val(),l={function:"createInvoice",clientData:c,serieInvoices:e,orderNum:g,orderItems:j,clientW:f,paymentMethod:h,numerocuenta:k,UsoCFDI:i};$.ajax({data:l,url:d+"modules/addons/facturacom/lib/apihandler.php",type:"post",dataType:"json",success:function(a){$("#error_message_end").hide(),"success"==a.response?($("#error_message_end").css("color","green"),$("#error_message_end").html(a.message),$("#error_message_end").show()):($("#error_message_end").html(a.message),$("#error_message_end").css("color","red"),$("#error_message_end").show(),m.removeAttr("disabled"),m.val("Crear factura")),$(this).val("Facturar"),$(this).attr("disabled",!1),"success"==a.response&&window.setTimeout(function(){location.reload()},5e3)}})})})